# Подробная Инструкция по Использованию Employee Data Pipeline

Это руководство поможет вам установить, настроить и использовать ETL-пайплайн для работы с синтетическими данными сотрудников.

## 1. Предварительные Требования

Перед началом убедитесь, что у вас установлены:

*   **Python 3.10** или выше.
    *   Проверить версию: `python --version` или `python3 --version`
*   **Poetry** (инструмент управления зависимостями).
    *   Установка (Windows PowerShell):
        ```powershell
        (Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -
        ```
    *   Установка (Linux/macOS):
        ```bash
        curl -sSL https://install.python-poetry.org | python3 -
        ```
    *   Проверить версию: `poetry --version`

## 2. Установка Проекта

1.  **Клонируйте репозиторий** (или скачайте исходный код):
    ```bash
    git clone https://github.com/your-username/employee-pipeline.git
    cd employee-pipeline
    ```

2.  **Установите зависимости**:
    Эта команда создаст виртуальное окружение и установит все необходимые библиотеки (pandas, faker, openpyxl, pytest и др.).
    ```bash
    poetry install
    ```
    *Если вы хотите установить только основные зависимости (без инструментов разработки), используйте `poetry install --only main`.*

## 3. Запуск Пайплайна

Пайплайн состоит из генерации данных, их загрузки, анализа и создания отчета.

### 3.1 Быстрый Запуск
Для запуска со стандартными настройками (1000 записей):
```bash
make run
```
или
```bash
poetry run python -m employee_pipeline.main
```

### 3.2 Запуск с Параметрами
Вы можете настроить количество записей и пути к файлам:

```bash
poetry run python -m employee_pipeline.main --count 5000 --csv my_data.csv --report my_report.xlsx
```

**Доступные аргументы:**
*   `--count`: Количество генерируемых сотрудников (по умолчанию: 1000).
*   `--csv`: Путь для сохранения/чтения CSV файла (по умолчанию: `employees.csv`).
*   `--report`: Путь для сохранения отчета Excel (по умолчанию: `report.xlsx`).

**Пример:**
Сгенерировать 10,000 сотрудников в файл `data/input.csv` и сохранить отчет в `results/2023_summary.xlsx`:
```bash
poetry run python -m employee_pipeline.main --count 10000 --csv data/input.csv --report results/2023_summary.xlsx
```
*(Убедитесь, что папки data и results существуют)*

## 4. Результаты Работы

После успешного выполнения вы получите два файла:

1.  **employees.csv** (или ваше имя файла):
    *   Сырые данные в формате CSV.
    *   Колонки: `id`, `name`, `job`, `department`, `salary`, `hire_date`, `email`.

2.  **report.xlsx** (или ваше имя файла):
    *   Файл Excel с аналитикой.
    *   **Лист "Summary"**: Общие метрики (всего сотрудников, средняя ЗП).
    *   **Лист "Departments"**: Статистика по отделам (численность, средняя ЗП).
    *   **Лист "Top Earners"**: Список сотрудников с самыми высокими зарплатами.

## 5. Разработка и Тестирование

Проект настроен для профессиональной разработки. Используйте `Makefile` для удобства.

### 5.1 Запуск Тестов
Проект имеет покрытие тестами >90%.
```bash
make test
```
Это запустит `pytest` с генерацией отчета о покрытии кода.

### 5.2 Проверка Качества Кода (Linting)
Запуск линтеров (Ruff) и проверки типов (Mypy):
```bash
make lint
```
Если есть ошибки (например, несоответствие типов), они будут выведены в консоль.

### 5.3 Форматирование Кода
Автоматическое исправление стиля кода:
```bash
make format
```

## 6. Структура Проекта (Где что лежит?)

*   `src/employee_pipeline/`: Исходный код.
    *   `protocols.py`: Интерфейсы (контракты) компонентов.
    *   `models.py`: Структуры данных (Employee, AnalysisResult).
    *   `generators.py`, `loaders.py`, `analyzers.py`, `reports.py`: Реализация логики.
    *   `pipeline.py`: Сборка всех компонентов воедино.
    *   `main.py`: Точка входа (CLI).
*   `tests/`: Тесты для каждого модуля.
*   `pyproject.toml`: Конфигурация проекта и зависимостей.
*   `Makefile`: Команды быстрого запуска.

## 7. Устранение Неполадок

**Проблема**: `Command not found: poetry`
*   **Решение**: Убедитесь, что Poetry установлен и добавлен в PATH. Перезапустите терминал.

**Проблема**: `FileNotFoundError` при запуске
*   **Решение**: Пайплайн сначала генерирует файл, потом читает. Если вы запускаете части отдельно (в коде), убедитесь, что CSV файл существует. При штатном запуске через `main.py` это происходит автоматически.

**Проблема**: Ошибки типов при запуске `make lint`
*   **Решение**: Mypy работает в строгом режиме. Если вы меняли код, убедитесь, что добавили аннотации типов ко всем аргументам и возвращаемым значениям.
